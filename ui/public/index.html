<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrmematey â€” Pirate Command Console</title>
    <link rel="icon" type="image/png" href="/images/arrmematey-icon.png">
    <style>
        :root {
            --deep: #030610;
            --surface: rgba(10, 16, 24, 0.8);
            --panel: rgba(7, 12, 20, 0.85);
            --border: rgba(255, 255, 255, 0.08);
            --accent: #f9c04d;
            --muted: rgba(255, 255, 255, 0.68);
            --text: #f5f7ff;
            font-family: 'Space Grotesk', 'Inter', 'Segoe UI', sans-serif;
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: var(--deep);
            color: var(--text);
            overflow-x: hidden;
        }

        .background-layer {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: saturate(1.2);
            opacity: 0;
            transition: opacity 1.6s ease, transform 2s ease;
            transform: scale(1.05);
            z-index: -3;
        }

        .background-layer.visible {
            opacity: 1;
            transform: scale(1);
        }

        .background-tint {
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, rgba(2, 5, 13, 0.75) 0%, rgba(2, 5, 13, 0.95) 100%);
            pointer-events: none;
            z-index: -2;
        }

        .dashboard {
            position: relative;
            z-index: 1;
            margin: 0 auto;
            max-width: 1200px;
            padding: 48px clamp(20px, 4vw, 64px) 64px;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .hero {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
        }

        .hero-text,
        .hero-panel {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 26px;
            padding: 32px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.45);
            backdrop-filter: blur(24px);
        }

        .hero-logo {
            width: 65%;
            height: auto;
            margin-bottom: 14px;
        }

        .hero-tag {
            color: var(--muted);
            font-size: 0.95rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 18px;
        }

        .hero-text h1 {
            font-size: clamp(3rem, 5vw, 4.5rem);
            margin: 0;
            line-height: 1.05;
        }

        .hero-text h1 span {
            color: var(--accent);
            display: block;
            font-weight: 600;
        }

        .hero-desc {
            margin-top: 18px;
            color: var(--muted);
            font-size: 1rem;
            line-height: 1.5;
        }

        .hero-tags {
            margin-top: 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .hero-tags span {
            padding: 6px 18px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
        }

        .hero-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-heading h2 {
            margin: 0;
            font-size: 1.4rem;
        }

        .panel-subtitle {
            margin: 4px 0 0;
            color: var(--muted);
            font-size: 0.9rem;
        }

        .panel-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 14px;
        }

        .panel-stats div {
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
        }

        .stat-label {
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            color: var(--muted);
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 2.1rem;
            font-weight: 600;
            color: var(--accent);
            margin: 6px 0;
        }

        .stat-meta {
            color: var(--muted);
            font-size: 0.85rem;
        }

        .pirate-message {
            border-radius: 18px;
            border: 1px dashed rgba(255, 255, 255, 0.25);
            background: rgba(255, 255, 255, 0.04);
            padding: 16px 20px;
            font-size: 1rem;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.02em;
            transition: opacity 0.4s ease;
            opacity: 0;
        }

        .pirate-message.visible {
            opacity: 1;
        }

        .services-panel {
            background: rgba(5, 8, 17, 0.85);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 32px;
            box-shadow: 0 32px 75px rgba(0, 0, 0, 0.35);
        }

        .services-grid {
            margin-top: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .service-card {
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 22px;
            padding: 20px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(6, 11, 22, 0.9));
            box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .service-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.08), transparent 55%);
            pointer-events: none;
        }

        .service-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .service-title {
            font-size: 1.15rem;
            font-weight: 600;
        }

        .service-id {
            font-size: 0.7rem;
            letter-spacing: 0.18em;
            color: var(--muted);
            text-transform: uppercase;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
        }

        .status-running {
            background: #59d89f;
            box-shadow: 0 0 12px rgba(89, 216, 159, 0.7);
        }

        .status-exited,
        .status-not-found {
            background: #ff6b6b;
            box-shadow: 0 0 12px rgba(255, 107, 107, 0.6);
        }

        .status-pending {
            background: #f9c04d;
            box-shadow: 0 0 12px rgba(249, 192, 77, 0.6);
        }

        .service-state {
            font-size: 0.8rem;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--muted);
            font-weight: 600;
        }

        .service-url {
            font-size: 0.95rem;
            color: var(--accent);
            margin: 0;
            position: relative;
            z-index: 1;
        }

        .service-url a {
            color: inherit;
            text-decoration: none;
        }

        .service-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: auto;
            position: relative;
            z-index: 1;
        }

        .service-actions button {
            flex: 1;
            min-width: 120px;
            padding: 10px 0;
            border-radius: 999px;
            border: none;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            cursor: pointer;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            font-weight: 600;
        }

        .service-actions button:hover {
            transform: translateY(-2px);
        }

        .action-restart {
            background: rgba(255, 255, 255, 0.12);
            color: #fff;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        .action-stop {
            background: #ff5d5d;
            color: #fff;
            box-shadow: 0 10px 25px rgba(255, 93, 93, 0.4);
        }

        .status-panel {
            display: flex;
            justify-content: center;
        }

        .status-card {
            width: 100%;
            max-width: 880px;
            border-radius: 28px;
            border: 1px solid var(--border);
            padding: 32px;
            background: rgba(7, 11, 22, 0.95);
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.45);
        }

        .status-card-title {
            font-size: 1.1rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .status-card-grid {
            margin-top: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
        }

        .status-card-grid > div {
            background: rgba(255, 255, 255, 0.01);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            padding: 18px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .status-label {
            font-size: 0.75rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .status-value {
            font-size: 1.8rem;
            color: var(--accent);
            font-weight: 600;
        }

        .status-note {
            margin-top: 18px;
            color: var(--muted);
            font-size: 0.95rem;
        }

        .loading {
            text-align: center;
            font-size: 1.1rem;
            color: var(--muted);
        }

        @media (max-width: 600px) {
            .dashboard {
                padding: 32px 18px 48px;
            }

            .hero,
            .services-panel,
            .hero-text,
            .hero-panel {
                padding: 24px;
            }

            .service-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="background-layer visible" id="bgLayer1"></div>
    <div class="background-layer" id="bgLayer2"></div>
    <div class="background-tint"></div>

    <main class="dashboard">
        <header class="hero">
            <div class="hero-text">
                <img src="/images/arrmematey-logo.svg" alt="Arrmematey" class="hero-logo">
                <p class="hero-tag">Pirate crew for your media empire</p>
                <h1>Arrmematey <span>Command Center</span></h1>
                <p class="hero-desc">Monitor every container, guide the crew, and stay ahead of the waves with a lean control deck built for your pirate stack.</p>
                <div class="hero-tags">
                    <span>Realtime radar</span>
                    <span>Fluid controls</span>
                    <span>Cloud ready</span>
                </div>
            </div>
            <div class="hero-panel">
                <div class="panel-heading">
                    <h2>Ship readiness</h2>
                    <p class="panel-subtitle">Refreshed every 5s</p>
                </div>
                <div class="panel-stats">
                    <div>
                        <div class="stat-label">Containers</div>
                        <div class="stat-value" id="dockerContainers">â€”</div>
                        <div class="stat-meta">total docked</div>
                    </div>
                    <div>
                        <div class="stat-label">Running</div>
                        <div class="stat-value" id="dockerRunning">â€”</div>
                        <div class="stat-meta">engines online</div>
                    </div>
                    <div>
                        <div class="stat-label">Images</div>
                        <div class="stat-value" id="dockerImages">â€”</div>
                        <div class="stat-meta">artifacts held</div>
                    </div>
                </div>
                <div id="pirateMessage" class="pirate-message">Captain, the deck is ready.</div>
            </div>
        </header>

        <section class="services-panel">
            <div class="panel-heading">
                <h2>Service roster</h2>
                <p class="panel-subtitle">Open, restart, or stop any service with a single tap.</p>
            </div>
            <div id="servicesContainer" class="services-grid">
                <div class="loading">Loading services...</div>
            </div>
        </section>

        <section class="status-panel">
            <div class="status-card">
                <div class="status-card-title">System snapshot</div>
                <div class="status-card-grid">
                    <div>
                        <div class="status-label">Last refreshed</div>
                        <div class="status-value" id="statusRefreshed">â€”</div>
                    </div>
                    <div>
                        <div class="status-label">Active services</div>
                        <div class="status-value" id="statusActiveServices">â€”</div>
                    </div>
                    <div>
                        <div class="status-label">Health</div>
                        <div class="status-value" id="statusSystem">Awaiting...</div>
                    </div>
                </div>
                <p class="status-note">Arrmematey polls Docker every 30 seconds; use the cards above for direct control.</p>
            </div>
        </section>
    </main>

    <script>
        const backgroundImages = [
            '/images/backgrounds/american-horror-story.jpg',
            '/images/backgrounds/big-trouble-in-little-china.jpg',
            '/images/backgrounds/bobs-burgers.jpg',
            '/images/backgrounds/ghostbusters.jpg',
            '/images/backgrounds/ghosts.jpg',
            '/images/backgrounds/teenage-mutant-ninja-turtles.jpg'
        ];

        class BackgroundRotator {
            constructor(images, interval = 5000) {
                this.images = images;
                this.interval = interval;
                this.layers = [
                    document.getElementById('bgLayer1'),
                    document.getElementById('bgLayer2')
                ];
                this.visibleLayer = 0;
                this.imageIndex = 0;
                this.initLayers();
            }

            initLayers() {
                this.layers.forEach(layer => layer.classList.remove('visible'));
                this.layers[this.visibleLayer].style.backgroundImage = `url('${this.images[0]}')`;
                this.layers[this.visibleLayer].classList.add('visible');
                this.schedule();
            }

            schedule() {
                this.timer = setInterval(() => this.rotate(), this.interval);
            }

            rotate() {
                this.imageIndex = (this.imageIndex + 1) % this.images.length;
                const nextLayerIndex = 1 - this.visibleLayer;
                const nextLayer = this.layers[nextLayerIndex];
                nextLayer.style.backgroundImage = `url('${this.images[this.imageIndex]}')`;
                nextLayer.classList.add('visible');
                this.layers[this.visibleLayer].classList.remove('visible');
                this.visibleLayer = nextLayerIndex;
            }
        }

        const pirateMessages = [
            'Ahoy! The crew is lined up and ready.',
            'Storm watch: containers holding steady.',
            'Fresh rum for the docker decks!',
            'Course plotted. System signals look clear.',
            'Treasure spotted: all services responding.',
            "Batten down the hatches. Everything's calm."
        ];

        let pirateMessageTimer;

        function showPirateMessage(customText) {
            const messageEl = document.getElementById('pirateMessage');
            const text = customText || pirateMessages[Math.floor(Math.random() * pirateMessages.length)];
            messageEl.textContent = text;
            messageEl.classList.add('visible');
            window.clearTimeout(pirateMessageTimer);
            pirateMessageTimer = window.setTimeout(() => {
                messageEl.classList.remove('visible');
            }, 5000);
        }

        function createServiceCard(service) {
            const rawStatus = (service.status || 'unknown').toLowerCase();
            const statusClass = rawStatus === 'running'
                ? 'status-dot status-running'
                : rawStatus === 'exited'
                    ? 'status-dot status-exited'
                    : rawStatus === 'not_found'
                        ? 'status-dot status-not-found'
                        : 'status-dot status-pending';
            const health = service.health || service.status || 'Unknown';
            const launchLabel = service.url
                ? `<a href="${service.url}" target="_blank" rel="noreferrer">Open dashboard</a>`
                : 'No URL available';
            const safeId = service.id || '';
            const actionDisabled = safeId === '' ? 'disabled' : '';
            const restartAction = safeId ? `onclick="restartService('${safeId}')"` : '';
            const stopAction = safeId ? `onclick="stopService('${safeId}')"` : '';
            return `
                <article class="service-card">
                    <div class="service-card-header">
                        <div class="${statusClass}"></div>
                        <div>
                            <div class="service-title">${service.icon || 'âš“'} ${service.name || 'Unknown'}</div>
                            <div class="service-id">${service.id || 'â€”'}</div>
                        </div>
                        <span class="service-state">${health}</span>
                    </div>
                    <p class="service-url">${launchLabel}</p>
                    <div class="service-actions">
                        <button class="action-restart" ${actionDisabled} ${restartAction}>Restart</button>
                        <button class="action-stop" ${actionDisabled} ${stopAction}>Stop</button>
                    </div>
                </article>
            `;
        }

        async function fetchServices() {
            const container = document.getElementById('servicesContainer');
            container.innerHTML = '<div class="loading">Loading services...</div>';
            try {
                const response = await fetch('/api/services');
                if (!response.ok) {
                    container.innerHTML = '<div class="loading">Failed to load services</div>';
                    return;
                }
                const services = await response.json();
                if (!services || services.length === 0) {
                    container.innerHTML = '<div class="loading">No services found</div>';
                    return;
                }
                container.innerHTML = services.map(s => createServiceCard(s)).join('');
            } catch (error) {
                console.error('Error fetching services:', error);
                container.innerHTML = '<div class="loading">Error fetching services</div>';
            }
        }

        async function fetchSystemInfo() {
            try {
                const response = await fetch('/api/system/info');
                if (!response.ok) {
                    return;
                }
                const data = await response.json();
                const docker = data.docker || {};
                document.getElementById('dockerContainers').textContent = docker.containers ?? 'â€”';
                document.getElementById('dockerRunning').textContent = docker.running ?? 'â€”';
                document.getElementById('dockerImages').textContent = docker.images ?? 'â€”';
                const servicesCount = (data.services && data.services.length) || 0;
                document.getElementById('statusActiveServices').textContent = `${servicesCount} tracked`;
                document.getElementById('statusRefreshed').textContent = new Date().toLocaleTimeString();
                const healthText = docker.running > 0 ? 'Crew ready' : 'All docked';
                document.getElementById('statusSystem').textContent = healthText;
            } catch (error) {
                console.error('Error fetching system info:', error);
            }
        }

        async function restartService(serviceId) {
            try {
                const response = await fetch(`/api/service/${serviceId}/restart`, { method: 'POST' });
                if (response.ok) {
                    showPirateMessage(`ðŸ”„ ${serviceId} be restarted!`);
                    fetchServices();
                } else {
                    showPirateMessage(`âš ï¸ Failed to restart ${serviceId}`);
                }
            } catch (error) {
                console.error('Error restarting service:', error);
                showPirateMessage(`âš ï¸ Error restarting ${serviceId}`);
            }
        }

        async function stopService(serviceId) {
            try {
                const response = await fetch(`/api/service/${serviceId}/stop`, { method: 'POST' });
                if (response.ok) {
                    showPirateMessage(`â¹ ${serviceId} be stopped!`);
                    fetchServices();
                } else {
                    showPirateMessage(`âš ï¸ Failed to stop ${serviceId}`);
                }
            } catch (error) {
                console.error('Error stopping service:', error);
                showPirateMessage(`âš ï¸ Error stopping ${serviceId}`);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new BackgroundRotator(backgroundImages, 5000);
            fetchServices();
            fetchSystemInfo();
            setTimeout(() => showPirateMessage(), 800);
            setInterval(() => {
                fetchServices();
                fetchSystemInfo();
            }, 30000);
            setInterval(() => {
                if (Math.random() > 0.7) {
                    showPirateMessage();
                }
            }, 20000);
        });
    </script>
</body>
</html>
